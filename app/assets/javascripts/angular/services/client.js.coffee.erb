<% environment.context_class.instance_eval { include ActionView::Helpers } %>
<% environment.context_class.instance_eval { include AngularHostHelper } %>

App.factory 'Client', ['$resource', 'Offline', ($resource, Offline) ->
  Offline.wrap 'Client', $resource('<%= angularApiPath('/api/clients/:id') %>', {format: 'json', id: '@id'}, {'save': {method: 'PUT'}}),
    (params, val) ->
      if params.query?
        if !val.name?.value?.match?(///#{params.query}///i)? &&
           !val.company?.value?.match?(///#{params.query}///i)? &&
           !val.emailAddress?.value?.match?(///#{params.query}///i)?
          return false
      if params.filter?
        for key, str of params.filter
          if str != '' && !val[key]?.value?.match?(///#{str}///i)?
            return false
      return true
]
